<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

        <title>Cart</title>
    </head>

    <style>
        h1 {
            text-align: center;
        }

        #box {
            padding: 10px;
            box-shadow: 0px 0px 3px lightgrey;
            width: 50%;
            margin: auto;
            background-color: transparent;

        }

        .obj {
            position: relative;
            color: grey;
            padding: 10px;
            margin: 20px;
            width: 95%;
            box-shadow: 0px 0px 3px grey;
        }

        img {
            max-width: 100%;
            width: auto;
            height: 50px;
        }

        h3 {
            color: black;
            font-size: 15px;
        }

        h5 {
            position: relative;
            top: -40px;
            text-align: right;
        }

        .btns {
            position: relative;
            top: -20px;
            float: right;
        }

        #qty {
            background-color: transparent;
            border: none;
        }

        .btn {
            position: absolute;
            top: 175px;
            left: 522px;
        }

        .operators {
            border-color: orange;
            background-color: orange;
            color: white;
        }

        .totalbtn {
            background-color: transparent;
            border: none;
            font-size: 22px;
            width: 20%;
        }

        span {
            font-size: 22px;
        }
    </style>



    <body>
        <h1>Cart-Items</h1>
        <div id="box">
            <h3>Total </h3>
            <span>$</span>
            <p id="subtotal"></p>
        </div>
    </body>

</html>

<script>

    let objinStore = localStorage.getItem("objinstore")

    let ArrofobjinStore = JSON.parse(objinStore)

    ArrofobjinStore.map((value, index) => {

        document.getElementById('box').innerHTML += `
        
        
         <div class=" obj">
                 <div style= " width: 100% ;"> <img src= ${value.imageSource} /> </div> 
                 <h3 > ${value.title}</h3>
                <h5 class="price">   ${value.price} </h5>
                <button class="btn btn-danger " onclick="  Removefromcart( event, ${index}) "> Remove </button>
                <div class="btns">
                <button onclick="minus(${index},event)" class=" operators" > &minus;    </button>
                <button id="qty"> 1 </button> 
                <button onclick=" plus(${index},event) " class="operators" >  &plus;  </button>
                </div> 
                <br>
                <p>Total</p>
              <span>$</span><button class="totalbtn"> ${value.price} </button>

            </div >    
    
        
        
        `
    })

    let Total = document.getElementsByClassName('totalbtn')
    let subtotal = document.getElementById('subtotal')

    function Removefromcart(event, index) {
        let objinStore = localStorage.getItem("objinstore")
        let ArrofobjinStore = JSON.parse(objinStore)
        ArrofobjinStore.splice(index, 1)
        localStorage.setItem("objinstore", JSON.stringify(ArrofobjinStore))
        subtotal.innerHTML = Number(subtotal.innerHTML) - Number(Total[index].innerHTML)
        event.target.closest('div').remove()
    }





    function plus(index, event) {
        let p = document.getElementsByClassName('price')
        let qty = event.target.closest('div').children[1].innerHTML
        let quantity = Number(qty)
        event.target.closest('div').children[1].innerHTML = quantity += 1
        let price = Number(p[index].innerHTML)
        Total[index].innerHTML = price * quantity
        subtotal.innerHTML = Number(subtotal.innerHTML) + price
    }

    function minus(index, event) {
        let p = document.getElementsByClassName('price')
        let qty = event.target.closest('div').children[1].innerHTML
        let price = Number(p[index].innerHTML)
        let quantity = Number(qty)

        if (quantity > 1) {
            event.target.closest('div').children[1].innerHTML = quantity - 1
            Total[index].innerHTML = Total[index].innerHTML - price
            subtotal.innerHTML = Number(subtotal.innerHTML) - price
        }

    }


    let sum = 0
    for (let index = 0; index < Total.length; index++) {

        sum = Number(sum) + Number(Total[index].innerHTML)

    }

    subtotal.innerHTML = sum




</script>